/* Ð°ï¿½Ð±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½ UDP Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð */
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <string.h>
#include <stdio.h>
#include <errno.h>
#include <unistd.h>
#include <stdlib.h>

int main(int argc, char **argv) {
  int sockfd; /* Ð°ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½ Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð */
  int n; /* Ð°ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð Ð°ÐÐ°ÐÐ±ï¿½ Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð°Ð 
            Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð */
  char sendline[1000], recvline[1000]; /* Ð°ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ±ï¿½ 
                                          Ð°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°Ð */
  struct sockaddr_in servaddr, cliaddr; /* Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ±ï¿½
                                           Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°Ð Ð°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð */
  /* Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð Ð°Ð 
     Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°Ð. Ð°ï¿½Ð±ï¿½Ð°Ð Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½ Ð°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð 
     Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½ */
  if(argc != 2){
    printf("Usage: a.out <IP address>\n");
    exit(1);
  }
  /* Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð UDP Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½ */
  if((sockfd = socket(PF_INET, SOCK_DGRAM, 0)) < 0){
    perror(NULL); /* Ð°ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð */
    exit(1);
  }
  /* Ð°ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð: Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°Ð 
     Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð TCP/IP, Ð±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ±ï¿½ Ñï¿½ï¿½ Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð, Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°Ð 
     Ð°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ±ï¿½. Ð°ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½ Ð°Ð Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð°Ð
     Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ°ÐÐ°Ð, Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°Ð 
     Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð     Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð, Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð±ï¿½ */
  bzero(&cliaddr, sizeof(cliaddr));
  cliaddr.sin_family = AF_INET;
  cliaddr.sin_port = htons(0);
  cliaddr.sin_addr.s_addr = htonl(INADDR_ANY);
  /* Ð°ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½ Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð */
  if(bind(sockfd, (struct sockaddr *) &cliaddr, 
          sizeof(cliaddr)) < 0){
    perror(NULL);
    close(sockfd); /* Ð°ï¿½Ð°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð 
                      Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½ Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð */
    exit(1);
  }
  /* Ð°ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°Ð Ð±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°Ð: 
     Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð TCP/IP, Ð±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ±ï¿½ Ñï¿½ï¿½ Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð
     Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°Ð, Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°Ð 7. Ð°ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½ Ð°Ð 
     Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð°Ð Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ°Ð
     Ð°ÐÐ°ÐÐ°ÐÐ°Ð, Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð, Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð
     Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð±ï¿½ */
  bzero(&servaddr, sizeof(servaddr));
  servaddr.sin_family = AF_INET;
  servaddr.sin_port = htons(7);
  if(inet_aton(argv[1], &servaddr.sin_addr) == 0){
    printf("Invalid IP address\n");
    close(sockfd); /* Ð°ï¿½Ð°Ð Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½ Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð 
                      Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½ Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°Ð */
    exit(1);
  }
  /* Ð°ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ±ï¿½, Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½ Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð±ï¿½ */
  printf("String => ");
  fgets(sendline, 1000, stdin);
  /* Ð°ï¿½Ð±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½ */
  if(sendto(sockfd, sendline, strlen(sendline)+1, 
            0, (struct sockaddr *) &servaddr, 
            sizeof(servaddr)) < 0){
    perror(NULL);
    close(sockfd);
    exit(1);
  }
  /* Ð°ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°Ð Ð°Ð Ð±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ°Ð. Ð°ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½ 
     Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½ Ñï¿½ï¿½ 1000 Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°ÐÐ°Ð, 
     Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ±ï¿½ Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½ Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð */
  if((n = recvfrom(sockfd, recvline, 1000, 0, 
                   (struct sockaddr *) NULL, NULL)) < 0){
    perror(NULL);
    close(sockfd);
    exit(1);
  }
  /* Ð°ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½Ð°ÐÐ°Ð Ð°ÐÐ±ï¿½Ð°ÐÐ°ÐÐ±ï¿½ Ð°Ð Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ°Ð Ð±ï¿½Ð°ÐÐ°ÐÐ°ÐÐ±ï¿½ */
  printf("%s\n", recvline);
  close(sockfd);
  return 0;
}
